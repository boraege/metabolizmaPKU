// BMI Percentile Reference Data (WHO/CDC based)
// Vücut Kitle İndeksi Persentil Değerleri

const BMI_PERCENTILE_DATA = {
    // Kız çocukları için BKI persentil değerleri
    female: {
        // Yaş (ay cinsinden): {p5, p15, p25, p50, p75, p85, p95}
        0: {p5: 11.4, p15: 12.2, p25: 12.6, p50: 13.5, p75: 14.4, p85: 14.9, p95: 15.8},
        3: {p5: 13.9, p15: 14.8, p25: 15.3, p50: 16.3, p75: 17.3, p85: 17.9, p95: 18.9},
        6: {p5: 14.7, p15: 15.4, p25: 15.9, p50: 16.9, p75: 18.0, p85: 18.6, p95: 19.7},
        9: {p5: 14.8, p15: 15.5, p25: 16.0, p50: 17.0, p75: 18.0, p85: 18.6, p95: 19.8},
        12: {p5: 14.6, p15: 15.3, p25: 15.7, p50: 16.6, p75: 17.7, p85: 18.2, p95: 19.4},
        15: {p5: 14.5, p15: 15.1, p25: 15.6, p50: 16.4, p75: 17.4, p85: 18.0, p95: 19.1},
        18: {p5: 14.2, p15: 14.9, p25: 15.3, p50: 16.2, p75: 17.1, p85: 17.7, p95: 18.8},
        24: {p5: 14.0, p15: 14.6, p25: 15.1, p50: 15.9, p75: 16.9, p85: 17.4, p95: 18.5},
        30: {p5: 13.9, p15: 14.6, p25: 15.0, p50: 15.8, p75: 16.7, p85: 17.3, p95: 18.3},
        36: {p5: 13.8, p15: 14.4, p25: 14.8, p50: 15.5, p75: 16.4, p85: 17.0, p95: 17.9},
        42: {p5: 13.7, p15: 14.3, p25: 14.7, p50: 15.5, p75: 16.4, p85: 17.0, p95: 18.0},
        48: {p5: 13.6, p15: 14.2, p25: 14.6, p50: 15.4, p75: 16.4, p85: 17.0, p95: 18.1},
        54: {p5: 13.5, p15: 14.2, p25: 14.6, p50: 15.4, p75: 16.5, p85: 17.1, p95: 18.2},
        60: {p5: 13.4, p15: 14.1, p25: 14.5, p50: 15.4, p75: 16.5, p85: 17.2, p95: 18.5},
        66: {p5: 13.4, p15: 14.0, p25: 14.5, p50: 15.5, p75: 16.6, p85: 17.3, p95: 18.8},
        72: {p5: 13.3, p15: 14.0, p25: 14.5, p50: 15.5, p75: 16.7, p85: 17.5, p95: 19.1},
        84: {p5: 13.3, p15: 14.0, p25: 14.5, p50: 15.6, p75: 16.9, p85: 17.8, p95: 19.7},
        96: {p5: 13.4, p15: 14.2, p25: 14.7, p50: 15.9, p75: 17.4, p85: 18.4, p95: 20.4},
        108: {p5: 13.6, p15: 14.5, p25: 15.1, p50: 16.4, p75: 18.1, p85: 19.2, p95: 21.5},
        120: {p5: 13.9, p15: 14.9, p25: 15.6, p50: 17.1, p75: 19.0, p85: 20.2, p95: 22.6},
        132: {p5: 14.5, p15: 15.6, p25: 16.4, p50: 18.0, p75: 20.0, p85: 21.3, p95: 23.8},
        144: {p5: 15.3, p15: 16.5, p25: 17.3, p50: 19.0, p75: 21.1, p85: 22.3, p95: 24.8},
        156: {p5: 16.3, p15: 17.5, p25: 18.3, p50: 19.9, p75: 21.9, p85: 23.1, p95: 25.4},
        168: {p5: 17.1, p15: 18.3, p25: 19.0, p50: 20.6, p75: 22.5, p85: 23.6, p95: 25.8},
        180: {p5: 17.7, p15: 18.8, p25: 19.5, p50: 21.0, p75: 22.8, p85: 23.9, p95: 26.0},
        192: {p5: 18.1, p15: 19.1, p25: 19.8, p50: 21.2, p75: 23.0, p85: 24.0, p95: 26.1},
        204: {p5: 18.5, p15: 19.5, p25: 20.1, p50: 21.5, p75: 23.1, p85: 24.2, p95: 26.2},
        216: {p5: 19.0, p15: 19.9, p25: 20.5, p50: 21.8, p75: 23.3, p85: 24.3, p95: 26.1}
    },
    
    // Erkek çocukları için BKI persentil değerleri
    male: {
        0: {p5: 11.4, p15: 12.2, p25: 12.7, p50: 13.7, p75: 14.6, p85: 15.2, p95: 16.1},
        3: {p5: 14.4, p15: 15.3, p25: 15.8, p50: 16.9, p75: 18.0, p85: 18.6, p95: 19.7},
        6: {p5: 15.0, p15: 15.9, p25: 16.5, p50: 17.5, p75: 18.6, p85: 19.2, p95: 20.3},
        9: {p5: 15.1, p15: 16.0, p25: 16.5, p50: 17.5, p75: 18.6, p85: 19.3, p95: 20.4},
        12: {p5: 14.9, p15: 15.7, p25: 16.2, p50: 17.2, p75: 18.3, p85: 18.9, p95: 20.0},
        15: {p5: 14.7, p15: 15.5, p25: 16.0, p50: 17.0, p75: 18.0, p85: 18.6, p95: 19.7},
        18: {p5: 14.5, p15: 15.3, p25: 15.7, p50: 16.7, p75: 17.7, p85: 18.3, p95: 19.3},
        24: {p5: 14.3, p15: 15.0, p25: 15.4, p50: 16.3, p75: 17.3, p85: 17.9, p95: 19.0},
        30: {p5: 14.2, p15: 14.8, p25: 15.3, p50: 16.2, p75: 17.2, p85: 17.7, p95: 18.8},
        36: {p5: 13.9, p15: 14.6, p25: 15.0, p50: 15.9, p75: 17.0, p85: 17.6, p95: 18.7},
        42: {p5: 13.8, p15: 14.5, p25: 14.9, p50: 15.8, p75: 16.8, p85: 17.4, p95: 18.5},
        48: {p5: 13.7, p15: 14.4, p25: 14.8, p50: 15.7, p75: 16.7, p85: 17.3, p95: 18.4},
        54: {p5: 13.6, p15: 14.2, p25: 14.7, p50: 15.6, p75: 16.6, p85: 17.2, p95: 18.4},
        60: {p5: 13.5, p15: 14.2, p25: 14.6, p50: 15.5, p75: 16.5, p85: 17.1, p95: 18.3},
        66: {p5: 13.4, p15: 14.1, p25: 14.5, p50: 15.4, p75: 16.5, p85: 17.1, p95: 18.4},
        72: {p5: 13.4, p15: 14.1, p25: 14.5, p50: 15.4, p75: 16.5, p85: 17.2, p95: 18.5},
        84: {p5: 13.6, p15: 14.3, p25: 14.7, p50: 15.7, p75: 16.9, p85: 17.6, p95: 19.1},
        96: {p5: 13.8, p15: 14.5, p25: 15.0, p50: 16.1, p75: 17.4, p85: 18.2, p95: 19.9},
        108: {p5: 14.0, p15: 14.8, p25: 15.3, p50: 16.5, p75: 18.0, p85: 19.0, p95: 21.0},
        120: {p5: 14.1, p15: 15.1, p25: 15.7, p50: 17.1, p75: 18.9, p85: 20.1, p95: 22.5},
        132: {p5: 14.6, p15: 15.8, p25: 16.5, p50: 18.2, p75: 20.4, p85: 21.7, p95: 24.5},
        144: {p5: 15.2, p15: 16.5, p25: 17.4, p50: 19.3, p75: 21.7, p85: 23.1, p95: 26.0},
        156: {p5: 15.6, p15: 17.0, p25: 18.0, p50: 19.9, p75: 22.3, p85: 23.7, p95: 26.5},
        168: {p5: 16.4, p15: 17.7, p25: 18.6, p50: 20.5, p75: 22.8, p85: 24.2, p95: 27.0},
        180: {p5: 17.2, p15: 18.5, p25: 19.4, p50: 21.2, p75: 23.4, p85: 24.8, p95: 27.6},
        192: {p5: 18.0, p15: 19.3, p25: 20.1, p50: 21.9, p75: 24.1, p85: 25.4, p95: 28.2},
        204: {p5: 18.7, p15: 19.9, p25: 20.7, p50: 22.5, p75: 24.7, p85: 26.1, p95: 28.8},
        216: {p5: 19.2, p15: 20.5, p25: 21.3, p50: 23.1, p75: 25.2, p85: 26.6, p95: 29.4}
    }
};

// Get ideal BMI (P50) for age in months and gender
function getIdealBMI(ageInMonths, gender) {
    const data = gender === 'male' ? BMI_PERCENTILE_DATA.male : BMI_PERCENTILE_DATA.female;
    
    // Find closest age
    const ages = Object.keys(data).map(Number).sort((a, b) => a - b);
    let closestAge = ages[0];
    let minDiff = Math.abs(ageInMonths - closestAge);
    
    for (const age of ages) {
        const diff = Math.abs(ageInMonths - age);
        if (diff < minDiff) {
            minDiff = diff;
            closestAge = age;
        }
    }
    
    return data[closestAge].p50;
}

// Get BMI percentile category
function getBMIPercentile(bmi, ageInMonths, gender) {
    const data = gender === 'male' ? BMI_PERCENTILE_DATA.male : BMI_PERCENTILE_DATA.female;
    
    // Find closest age
    const ages = Object.keys(data).map(Number).sort((a, b) => a - b);
    let closestAge = ages[0];
    let minDiff = Math.abs(ageInMonths - closestAge);
    
    for (const age of ages) {
        const diff = Math.abs(ageInMonths - age);
        if (diff < minDiff) {
            minDiff = diff;
            closestAge = age;
        }
    }
    
    const percentiles = data[closestAge];
    
    if (bmi < percentiles.p5) return 'P<5 (Çok Zayıf)';
    if (bmi < percentiles.p15) return 'P5-15 (Zayıf)';
    if (bmi < percentiles.p25) return 'P15-25';
    if (bmi < percentiles.p50) return 'P25-50';
    if (bmi < percentiles.p75) return 'P50-75 (Normal)';
    if (bmi < percentiles.p85) return 'P75-85';
    if (bmi < percentiles.p95) return 'P85-95 (Fazla Kilolu)';
    return 'P>95 (Obez)';
}
