<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>Metabolizma HesaplayÄ±cÄ± PKU</title>
    <link rel="stylesheet" href="css/main.css?v=2">
    <link rel="stylesheet" href="css/user-input.css?v=6">
    <link rel="stylesheet" href="css/reference.css?v=4">
    <link rel="stylesheet" href="css/calculations.css">
    <link rel="stylesheet" href="css/food-selection.css">
    <link rel="stylesheet" href="css/meal-planning.css?v=7">
    <link rel="stylesheet" href="css/history.css">
    <link rel="stylesheet" href="css/tooltip.css">
    <link rel="stylesheet" href="css/mobile.css?v=6">
    <link rel="stylesheet" href="css/modal.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div>
                    <h1>Metabolizma HesaplayÄ±cÄ± PKU</h1>
                    <p>Beslenme ve Metabolizma DeÄŸerlendirme Sistemi</p>
                </div>
                <div class="header-actions">
                    <button id="viewPatientsBtn" class="btn-secondary">ğŸ‘¥ HastalarÄ±m</button>
                    <div class="user-info" id="userInfo" style="display: none;">
                        <span id="userDisplayName">KullanÄ±cÄ±</span>
                        <button id="logoutBtn" class="btn-logout">Ã‡Ä±kÄ±ÅŸ Yap</button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Section 1: Personal Information -->
        <div class="card">
            <section id="personal-info" class="section">
                <h2>1. KiÅŸisel Bilgiler</h2>
                <div class="personal-info-compact">
                    <div class="info-row">
                        <div class="form-group">
                            <label for="patientName">ğŸ‘¤ Ad Soyad</label>
                            <input type="text" id="patientName" placeholder="Hasta adÄ±" required>
                        </div>
                        <div class="form-group">
                            <label for="birthDate">ğŸ‚ DoÄŸum Tarihi <span id="ageDisplay" class="age-display-inline"></span></label>
                            <input type="date" id="birthDate" required>
                        </div>
                    </div>
                    <div class="info-row">
                        <div class="form-group">
                            <label for="height">ğŸ“ Boy (cm)</label>
                            <input type="number" id="height" step="0.1" placeholder="165.5" required>
                        </div>
                        <div class="form-group">
                            <label for="weight">âš–ï¸ Kilo (kg)</label>
                            <input type="number" id="weight" step="0.1" placeholder="55.5" required>
                        </div>
                        <div class="form-group gender-compact">
                            <label>âš¥ Cinsiyet</label>
                            <div class="radio-group-compact">
                                <label class="gender-option-compact">
                                    <input type="radio" name="gender" value="male" required>
                                    <span>ğŸ‘¦ Erkek</span>
                                </label>
                                <label class="gender-option-compact">
                                    <input type="radio" name="gender" value="female">
                                    <span>ğŸ‘§ KadÄ±n</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Section 2: Percentile Tables Preview -->
        <div class="card">
            <section id="percentile-tables-preview" class="section">
                <h2>2. Persentil DeÄŸerleri KarÅŸÄ±laÅŸtÄ±rmasÄ±</h2>
                <p style="color: #666; margin-bottom: 20px;">KiÅŸisel bilgilerinizi girdikten sonra, yaÅŸÄ±nÄ±za uygun Neyzi ve WHO persentil deÄŸerlerini karÅŸÄ±laÅŸtÄ±rabilirsiniz.</p>
                
                <div id="percentileTablesContainer">
                    <div class="tables-preview">
                        <div class="percentile-table-section">
                            <h3>ğŸ“Š Neyzi (TÃ¼rkiye ReferansÄ±)</h3>
                            <div id="neyziTablesPreview">
                                <p style="color: #666; font-style: italic; padding: 20px; text-align: center;">LÃ¼tfen doÄŸum tarihi ve cinsiyet bilgilerini girin.</p>
                            </div>
                        </div>
                        
                        <div class="percentile-table-section">
                            <h3>ğŸŒ WHO (DÃ¼nya SaÄŸlÄ±k Ã–rgÃ¼tÃ¼)</h3>
                            <div id="whoTablesPreview">
                                <p style="color: #666; font-style: italic; padding: 20px; text-align: center;">LÃ¼tfen doÄŸum tarihi ve cinsiyet bilgilerini girin.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Section 3: Percentile Source Selection -->
        <div class="card">
            <section id="percentile-source" class="section">
                <h2>3. Persentil KaynaÄŸÄ± SeÃ§imi</h2>
                <div class="tab-container">
                    <button class="tab-button active" data-source="manual">Manuel</button>
                    <button class="tab-button" data-source="neyzi">Neyzi</button>
                    <button class="tab-button" data-source="who">WHO</button>
                </div>
                <div id="sourceDescription" class="source-description"></div>
                <button id="calculateNeeds" class="btn-primary" style="margin-top: 20px;">Hesapla</button>
            </section>
        </div>

        <!-- Section 4: Reference Values Display -->
        <div class="card">
            <section id="reference-display" class="section hidden-until-calculation">
                <h2>4. Referans DeÄŸerler</h2>
                <div id="referenceWarning" class="warning-box" style="display:none;"></div>
                <div id="referenceTable" class="reference-table"></div>
            </section>
        </div>

        <!-- Section 5: Daily Needs Calculation -->
        <div class="card">
            <section id="daily-needs" class="section results-section hidden-until-calculation">
                <h2>5. GÃ¼nlÃ¼k Ä°htiyaÃ§lar</h2>
                <div class="needs-grid">
                    <div class="need-item">
                        <label>BMR (kcal/gÃ¼n):</label>
                        <span id="bmrValue">-</span>
                    </div>
                    <div class="need-item">
                        <label>Enerji (Ref) (kcal):</label>
                        <span id="energyRefValue">-</span>
                    </div>
                    <div class="need-item">
                        <label>Enerji (Pratik) (kcal):</label>
                        <input type="number" id="energyPracticalValue" step="1">
                    </div>
                    <div class="need-item">
                        <label>Protein (g/gÃ¼n):</label>
                        <span id="proteinValue">-</span>
                    </div>
                    <div class="need-item">
                        <label>Fenilalanin (mg/gÃ¼n):</label>
                        <span id="pheValue">-</span>
                    </div>
                </div>
            </section>
        </div>

        <!-- Section 6: Nutritional Reference Table -->
        <div class="card">
            <section id="nutrition-reference" class="section hidden-until-calculation">
                <h2>6. Beslenme Referans Tablosu</h2>
                <div id="nutritionRefTable" class="nutrition-table"></div>
            </section>
        </div>

        <!-- Section 7: Food Selection -->
        <div class="card">
            <section id="food-selection" class="section hidden-until-calculation">
                <h2>7. Besin SeÃ§imi</h2>
                
                <div class="food-selection-header">
                    <div class="food-categories">
                        <button class="category-btn active" data-category="bread">Ekmek ve TahÄ±l</button>
                        <button class="category-btn" data-category="vegetables">Sebzeler</button>
                        <button class="category-btn" data-category="fruits">Meyveler</button>
                    </div>
                    <div class="food-search-container">
                        <input type="text" id="foodSearchInput" class="food-search-input" placeholder="ğŸ” Besin ara...">
                        <button id="clearSearchBtn" class="clear-search-btn hidden">Ã—</button>
                    </div>
                </div>
                <div id="foodList" class="food-list"></div>
                <div id="dailyIntake" class="daily-intake">
                    <h3>GÃ¼nlÃ¼k AlÄ±m</h3>
                    <p style="color: #666; font-size: 0.9em; margin-bottom: 10px;">ğŸ’¡ Besinleri buraya sÃ¼rÃ¼kleyin veya tÄ±klayÄ±n</p>
                    <div id="intakeList" class="intake-list" data-drop-zone="true"></div>
                    <div class="intake-totals">
                        <div>Toplam Enerji: <span id="totalEnergy">0</span> kcal</div>
                        <div>Toplam Protein: <span id="totalProtein">0</span> g</div>
                        <div>Toplam Fenilalanin: <span id="totalPhe">0</span> mg</div>
                    </div>
                    <div id="progressChart" class="progress-chart"></div>
                </div>
            </section>
        </div>

        <!-- Section 8: Meal Planning -->
        <div class="card">
            <section id="meal-planning" class="section hidden-until-calculation">
                <h2>8. Ã–ÄŸÃ¼n PlanlamasÄ±</h2>
                <button id="addMeal" class="btn-secondary">Ã–ÄŸÃ¼n Ekle</button>
                
                <div class="meal-planning-container">
                    <div class="available-foods-panel">
                        <h3>SeÃ§ilen Besinler</h3>
                        <p class="panel-hint">Besinleri sÃ¼rÃ¼kleyip Ã¶ÄŸÃ¼nlere bÄ±rakÄ±n</p>
                        <div id="availableFoodsList" class="available-foods-list"></div>
                    </div>
                    <div class="meal-slots-panel">
                        <div id="mealSlots" class="meal-slots"></div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Section 9: Export -->
        <div class="card">
            <section id="export-section" class="section hidden-until-calculation">
                <h2>9. Rapor ve KayÄ±t</h2>
                <div class="export-actions">
                    <button id="saveToPatientBtn" class="btn-primary">ğŸ’¾ HastalarÄ±ma Kaydet</button>
                    <button id="exportPDF" class="btn-primary">ğŸ“„ PDF Ä°ndir</button>
                </div>
            </section>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- Auth Scripts -->
    <script src="js/auth/firebase-config.js"></script>
    <script src="js/auth/auth-manager.js"></script>
    <script src="js/auth/user-data-manager.js"></script>
    <script src="js/patients/patient-manager.js"></script>
    <script src="js/patients/save-to-patient.js"></script>

    <!-- Scripts -->
    <script src="js/data/reference-data.js"></script>
    <script src="js/data/food-data.js"></script>
    <script src="js/utils/age-calculator.js"></script>
    <script src="js/utils/reference-lookup.js"></script>
    <script src="js/utils/validation.js"></script>
    <script src="js/utils/storage.js"></script>
    <script src="js/utils/modal.js"></script>
    <script src="js/calculations/bmr.js"></script>
    <script src="js/calculations/daily-needs.js"></script>
    <script src="js/ui/user-input.js"></script>
    <script src="js/ui/reference-display.js"></script>
    <script src="js/ui/food-selection.js"></script>
    <script src="js/ui/meal-planning.js"></script>
    <script src="js/ui/history-viewer.js?v=2"></script>
    <script src="js/ui/tooltip.js?v=2"></script>
    <script src="js/export/pdf-export.js?v=5"></script>
    <script src="js/main.js?v=2"></script>
</body>
</html>
